{% extends 'partials/base.html' %}
{% block title %} Motoboys Cadastrados {% endblock title %}

{% block extra_css %}
<!-- Sweet Alert css-->
<link href="{{ url_for('static', filename='libs/sweetalert2/sweetalert2.min.css') }}" rel="stylesheet" type="text/css">
<!-- Se você usa DataTables, mantenha os estilos necessários -->
<link rel="stylesheet" href="{{ url_for('static', filename='libs/datatables/dataTables.bootstrap5.min.css') }}">
{% endblock extra_css %}

{% block content %}

<!-- Tabela completa -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0"><i class="bi bi-table"></i>Motoboys</h5>
            </div>

            <div class="card-body">
                <div class="table-responsive">
                    <table id="motoboys-table" class="table table-bordered table-striped align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Telefone</th>
                                <th>CPF</th>
                                <th>Placa</th>
                                <th>Status</th>
                                <th>Último Pedido</th>
                                <th>Hora Livre</th>
                                <th>Etiqueta</th>
                                <th>Editar</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for m in moto_boy %}
                            <tr>
                                <td>{{ m.id }}</td>
                                <td>{{ m.nome }}</td>
                                <td>{{ m.telefone }}</td>
                                <td>{{ m.cpf }}</td>
                                <td>{{ m.placa }}</td>
                                <td>
                                    {% if m.status == 'on' or m.status == 'ativo' %}
                                        <span class="badge bg-success-subtle text-success">Ativo</span>
                                    {% elif m.status == 'off' or m.status == 'inativo' %}
                                        <span class="badge bg-danger-subtle text-danger">Offline</span>
                                    {% else %}
                                        <span class="badge bg-secondary-subtle text-secondary">{{ m.status or '-' }}</span>
                                    {% endif %}
                                </td>
                                <td>{{ m.id_pedido or '-' }}</td>
                                <td>{{ m.hora_livre or '-' }}</td>
                                <td>{{ m.etiqueta or '-' }}</td>
                                <td>
                                 <button
                                    class="btn btn-sm btn-primary"
                                    onclick="abrirModalMotoboy(this)"
                                    data-id="{{ m.id }}"
                                    data-nome="{{ m.nome }}"
                                    data-telefone="{{ m.telefone }}"
                                    data-cpf="{{ m.cpf }}"
                                    data-placa="{{ m.placa }}"
                                    >
                                    Editar
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock content %}

{% block extra_content %}

<div class="modal fade" id="modalEditarMotoboy" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <!-- FORM DE EDITAR -->
      <form method="POST" action="{{ url_for('admin_app.editar_motoboy') }}">
        <div class="modal-header">
          <h5 class="modal-title">Editar Motoboy</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <input type="hidden" name="id" id="motoboy-id">

          <div class="row g-3">
            <div class="col-md-6">
              <label>Nome</label>
              <input type="text" class="form-control" name="nome" id="motoboy-nome">
            </div>

            <div class="col-md-6">
              <label>Telefone</label>
              <input type="text" class="form-control" name="telefone" id="motoboy-telefone">
            </div>

            <div class="col-md-6">
              <label>CPF</label>
              <input type="text" class="form-control" name="cpf" id="motoboy-cpf">
            </div>

            <div class="col-md-6">
              <label>Placa</label>
              <input type="text" class="form-control" name="placa" id="motoboy-placa">
            </div>
          </div>
        </div>

        <div class="modal-footer justify-content-between">
          <button type="submit" class="btn btn-success">Salvar</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        </div>
      </form>

      <!-- FORM DE DELETAR (fora do outro form) -->
      <form method="POST"
            action="{{ url_for('admin_app.deletar_motoboy') }}"
            class="p-3 border-top">
        <input type="hidden" name="id" id="motoboy-id-delete">
        <button type="submit"
                class="btn btn-danger w-100"
                onclick="return confirm('Tem certeza que deseja deletar este motoboy?')">
          Deletar Motoboy
        </button>
      </form>

    </div>
  </div>
</div>

{% endblock extra_content %}

{% block extra_js %}
<!-- Dependências opcionais: DataTables (se já usar), Flatpickr, etc -->
<script src="{{ url_for('static', filename='libs/jquery/jquery.min.js') }}"></script>
<script src="{{ url_for('static', filename='libs/datatables/jquery.dataTables.min.js') }}"></script>
<script src="{{ url_for('static', filename='libs/datatables/dataTables.bootstrap5.min.js') }}"></script>

<script>
    // Inicializa DataTable
    $(document).ready(function () {
        $('#motoboys-table').DataTable({
            responsive: true,
            pageLength: 10,
            language: {
                url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/pt-BR.json"
            }
        });
    });

  function abrirModalMotoboy(btn) {
        const modalEl = document.getElementById('modalEditarMotoboy');
        const modal = new bootstrap.Modal(modalEl);

        const fields = ['id', 'nome', 'telefone', 'cpf', 'placa'];

        fields.forEach(field => {
            const input = document.getElementById(`motoboy-${field}`);
            if (input) {
            input.value = btn.dataset[field] ?? '';
            }
        });

        // id usado no delete
        document.getElementById('motoboy-id-delete').value = btn.dataset.id;

        modal.show();
        }
</script>

<!-- Seus outros scripts -->
<script src="{{ url_for('static', filename='js/pages/invoice-list.init.js') }}"></script>
<script src="{{ url_for('static', filename='ajax/detalhes.js') }}"></script>
<script src="{{ url_for('static', filename='libs/apexcharts/apexcharts.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/pages/dashboard-real-estate.init.js') }}"></script>
{% endblock extra_js %}
